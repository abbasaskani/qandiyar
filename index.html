<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ููุฏุงุฑ | ุฏุงุดุจูุฑุฏ ุญุฑููโุง</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="bg-anim" aria-hidden="true"></div>

  <header class="app-header">
    <div class="brand">
      <div class="logo">๐</div>
      <div class="title">
        <h1 id="brand-title">ููุฏุงุฑ</h1>
        <p class="tagline"><span id="brand-tagline">ุจุง ููุฏุงุฑุ ฺฏุงู ุจุฑุง ุณูุงูุช ุจุฑุฏุงุฑ.</span></p>
      </div>
    </div>

    <div class="header-actions">
      <label class="switch" title="Demo Mode (ุบุฑูุงูุน)">
        <input id="demo-toggle" type="checkbox" />
        <span class="slider"></span>
        <span class="switch-label">Demo ๐ค</span>
      </label>

      <label class="switch" title="Language">
        <input id="lang-toggle" type="checkbox" />
        <span class="slider"></span>
        <span class="switch-label">FA/EN ๐</span>
      </label>

      <button id="btn-load-sample" class="btn btn-ghost" title="ููุฏ ุฏุชุง ููููู (ุจุฏูู fetch)">๐ฆ ุฏุชุง ููููู</button>
      <button id="btn-export" class="btn btn-ghost">โฌ๏ธ ุฎุฑูุฌ JSON</button>
      <button id="btn-export-csv" class="btn btn-ghost">โฌ๏ธ CSV</button>
      <label class="btn btn-ghost">
        โฌ๏ธ ูุฑูุฏ JSON
        <input id="file-import" type="file" accept="application/json" hidden />
      </label>
      <button id="btn-pdf" class="btn btn-ghost">๐งพ PDF ูพุฒุดฺฉ</button>
      <button id="btn-reset" class="btn btn-danger">๐๏ธ ุฑุณุช</button>
    </div>
  </header>

  <main class="container">
    <nav class="tabs" aria-label="ููู">
      <button class="tab active" data-tab="dashboard">๐ ุฏุงุดุจูุฑุฏ</button>
      <button class="tab" data-tab="timeline">๐งพ ุชุงูโูุงู</button>
      <button class="tab" data-tab="register">๐ ุซุจุช</button>
      <button class="tab" data-tab="nutrition">๐ฝ๏ธ ุชุบุฐู</button>
      <button class="tab" data-tab="analytics">๐ง ุชุญูู</button>
      <button class="tab" data-tab="education">๐ ุขููุฒุด</button>
      <button class="tab" data-tab="data">๐๏ธ ุฏุงุฏูโูุง</button>
      <button class="tab" data-tab="profile">๐ค ูพุฑููุงู</button>
      <button class="tab" data-tab="sickday">๐งฐ Sick-day</button>
      <button class="tab" data-tab="audit">๐งพ ูุงฺฏ</button>
    </nav>

    <section id="banner" class="banner" hidden></section>

    <button id="fab" class="fab" title="ุซุจุช ุณุฑุน +">๏ผ</button>
    <div id="fab-menu" class="fab-menu" hidden>
      <button class="btn btn-primary" data-quick="glucose">๐ฉธ ุซุจุช ููุฏ</button>
      <button class="btn btn-primary" data-quick="meal">๐ฝ๏ธ ุซุจุช ูุนุฏู</button>
      <button class="btn btn-primary" data-quick="insulin">๐ ุซุจุช ุงูุณููู</button>
    </div>

    <section class="panel show" id="tab-dashboard">
      <div class="grid">
        <div class="card span-2">
          <div class="card-head">
            <h2 id="dash-title">๐ ุฏุงุดุจูุฑุฏ ููุฏ ุฎูู</h2>
            <div class="dash-controls">
              <div class="pill">
                <span id="range-lbl">ุจุงุฒู:</span>
                <select id="range-select">
                  <option value="day">ุฑูุฒ</option>
                  <option value="week">ท ุฑูุฒ</option>
                  <option value="month" selected>ณฐ ุฑูุฒ</option>
                </select>
              </div>
              <div class="pill">
                <span id="enddate-lbl">ุชุงุฑุฎ ุงูุชูุง:</span>
                <input id="range-date" type="date" />
              </div>
              <div class="pill">
                <span id="zone-lbl">ูุงุญู ูุฏู:</span>
                <select id="zone-style">
                  <option value="bands" selected>ุฑูฺฏ</option>
                  <option value="gradient">ฺฏุฑุงุฏุงู</option>
                </select>
              </div>
            </div>
          </div>

          <div class="kpis" id="kpi-row"></div>

          <div class="chart-hero">
            <canvas id="glucoseChart"></canvas>
          </div>

          <div class="subgrid">
            <div class="mini">
              <h3>โฑ๏ธ ุฒูุงู ุฏุฑ ูุฏู (ุชุฎูู)</h3>
              <div id="tir-hours" class="big-metric">โ</div>
              <div class="muted" id="tir-detail"></div>
              <div class="hint">ูุญุงุณุจู ุจุง ุงูุชุฑูพููุดู ุฎุท ุจู ููุงุท ููุงู ุฑูุฒ ุงูุฌุงู ูโุดูุฏ.</div>
            </div>

            <div class="mini">
              <h3>๐ ุงูฺฏููุง</h3>
              <div id="patterns" class="insights"></div>
            </div>

            <div class="mini">
              <h3>๐ค Demo Suggestions</h3>
              <div id="ai-insights" class="insights"></div>
              <div class="hint">โ๏ธ ููุท ุฏูู/ุขููุฒุด โ ุนุฏุฏ ุฏูุฒ ูุงูุน ูุฏุงุฑุฏ.</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>๐ฝ๏ธ ุชุญูู ูุนุฏูโูุง (ูุฑุชุจ)</h2>
          <div class="table-wrap">
            <table id="tbl-meal-analysis">
              <thead><tr><th>ุชุงุฑุฎ</th><th>ูุนุฏู</th><th>ฺฉุฑุจููุฏุฑุงุช</th><th>ููุฏ ฒุณุงุนุช ุจุนุฏ</th><th>ูุถุนุช</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="hint">๐ ูุฑ ูุนุฏู ุฑุง ุจู ููุฏ ฒ ุณุงุนุช ุจุนุฏ ููฺฉ ฺฉู ุชุง ุชุญูู ุฏููโุชุฑ ุดูุฏ.</div>
        </div>

        <div class="card">
          <h2>๐ฅ Heatmap ุฑูุฒ/ุณุงุนุช</h2>
          <canvas id="heatmap" height="260"></canvas>
          <div class="hint">ูุฑ ุฎุงูู: ูุงูฺฏู ุชุฎูู ููุฏ ุฏุฑ ุขู ุณุงุนุช (ููุงุด).</div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-timeline">
      <div class="grid">
        <div class="card span-2">
          <div class="card-head">
            <h2>๐งพ ุชุงูโูุงู ุฑูุฒุงูู</h2>
            <div class="pill">
              <span>ุฑูุฒ:</span>
              <input id="timeline-date" type="date" />
            </div>
          </div>
          <div id="timeline" class="timeline"></div>
          <div class="hint">ููุฏ/ุงูุณููู/ุบุฐุง ุจู ุชุฑุชุจ ุฒูุงู ฺฉูุงุฑ ูู.</div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-register">
      <div class="grid">
        <div class="card">
          <h2>๐ฉธ ุซุจุช ููุฏ</h2>

          <div class="quick-add">
            <div class="muted">Quick Add:</div>
            <div class="quick-row">
              <button class="chip-btn" data-q="90">90</button>
              <button class="chip-btn" data-q="120">120</button>
              <button class="chip-btn" data-q="150">150</button>
              <button class="chip-btn" data-q="180">180</button>
              <button class="chip-btn" data-q="220">220</button>
            </div>
          </div>

          <form id="glucose-form" class="form">
            <div class="row">
              <label>ุชุงุฑุฎ</label>
              <input name="date" type="date" />
            </div>
            <div class="row">
              <label>ุญุงูุช</label>
              <select name="slot">
                <option value="FBS">FBS (ูุงุดุชุง)</option>
                <option value="AfterBreakfast2h">ฒ ุณุงุนุช ุจุนุฏ ุตุจุญุงูู</option>
                <option value="BeforeLunch">ูุจู ูุงูุงุฑ</option>
                <option value="AfterLunch2h">ฒ ุณุงุนุช ุจุนุฏ ูุงูุงุฑ</option>
                <option value="BeforeDinner">ูุจู ุดุงู</option>
                <option value="AfterDinner2h">ฒ ุณุงุนุช ุจุนุฏ ุดุงู</option>
                <option value="BeforeBed">ูุจู ุฎูุงุจ</option>
              </select>
            </div>
            <div class="row">
              <label>ุนุฏุฏ ููุฏ</label>
              <input name="value" type="number" min="20" max="600" required placeholder="ูุซูุงู 145" />
            </div>
            <div class="row">
              <label>ุงุฏุฏุงุดุช</label>
              <input name="note" type="text" placeholder="ุงุณุชุฑุณ/ูุฑุฒุด/ุชุจ..." />
            </div>
            <button class="btn btn-primary" type="submit">โ ุซุจุช</button>
            <p class="hint">๐ข ุฏุงุฎู ูุฏู | ๐ก ุฎุงุฑุฌ ูุฏู | ๐ฅ ููพู | ๐ง ูุงูพุฑ ุดุฏุฏ</p>
          </form>
          <div id="alert-box" class="alert" hidden></div>
        </div>

        <div class="card">
          <h2>๐ ุซุจุช ุงูุณููู</h2>
          <form id="insulin-form" class="form">
            <div class="row">
              <label>ุชุงุฑุฎ</label>
              <input name="date" type="date" />
            </div>
            <div class="row">
              <label>ููุน</label>
              <select name="kind">
                <option value="Basal">Basal</option>
                <option value="Bolus">Bolus</option>
                <option value="Correction">Correction</option>
              </select>
            </div>
            <div class="row">
              <label>ูุงู</label>
              <input name="name" type="text" placeholder="Lantus / Novorapid" required />
            </div>
            <div class="row">
              <label>ูุงุญุฏ (ุซุจุชโุดุฏู)</label>
              <input name="units" type="number" min="0" max="100" step="0.5" required />
            </div>
            <div class="row">
              <label>ุณุงุนุช</label>
              <input name="time" type="time" />
            </div>
            <div class="row">
              <label>ูุนุฏู</label>
              <select name="mealRef">
                <option value="">โ</option>
                <option value="Breakfast">ุตุจุญุงูู</option>
                <option value="Lunch">ูุงูุงุฑ</option>
                <option value="Dinner">ุดุงู</option>
              </select>
            </div>
            <div class="row">
              <label>ุงุฏุขูุฑ Basal</label>
              <div class="inline">
                <input id="basal-reminder" name="reminder" type="checkbox" />
                <span>ูุนุงู ุดูุฏ</span>
              </div>
            </div>
            <button class="btn btn-primary" type="submit">๐ ุซุจุช</button>
          </form>
          <div class="hint">โฐ ุงฺฏุฑ ุฏุฑ ุจุงุฒูโุง ุซุจุช ุงูุฌุงู ูุดูุฏุ Check-in ูู ูุนุงู ูโุดูุฏ.</div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-nutrition">
      <div class="grid">
        <div class="card span-2">
          <h2>๐ฝ๏ธ ุจุงูฺฉ ุบุฐุง ุงุฑุงู (ฺฏุณุชุฑุฏู)</h2>
          <div class="foodbar">
            <input id="food-search" type="text" placeholder="ุฌุณุชุฌู: ุจุฑูุฌุ ูุงูุ ุฎูุฑุดุชุ ููู..." />
            <select id="food-cat"></select>
            <select id="food-unit">
              <option value="g" selected>ฺฏุฑู</option>
              <option value="serv">ูพุฑุณ/ูุงุญุฏ</option>
            </select>
            <input id="food-amount" type="number" min="1" step="1" value="100" />
            <button id="btn-add-food" class="btn btn-primary">โ ุงูุฒูุฏู ุจู ูุนุฏู</button>
          </div>
          <div id="food-results" class="food-results"></div>
          <div class="hint">โ ุงูุชุฎุงุจ ุบุฐุง โ ฺฉุฑุจููุฏุฑุงุช ุชุฎูู โ ุซุจุช ูุนุฏู ุณุฑุนโุชุฑ</div>
        </div>

        <div class="card">
          <h2>๐ฝ๏ธ ุซุจุช ูุนุฏู + ุงูฺฏู</h2>
          <form id="meal-form" class="form">
            <div class="row">
              <label>ุชุงุฑุฎ</label>
              <input name="date" type="date" />
            </div>
            <div class="row">
              <label>ูุนุฏู</label>
              <select name="meal">
                <option value="Breakfast">ุตุจุญุงูู</option>
                <option value="Lunch">ูุงูุงุฑ</option>
                <option value="Dinner">ุดุงู</option>
                <option value="Snack">ูุงูโูุนุฏู</option>
              </select>
            </div>
            <div class="row">
              <label>ูุงูุจ ุขูุงุฏู</label>
              <select name="template" id="meal-template"></select>
            </div>
            <div class="row">
              <label>ุดุฑุญ</label>
              <input name="desc" type="text" required />
            </div>
            <div class="row">
              <label>ฺฉุฑุจููุฏุฑุงุช (g)</label>
              <input name="carbs" type="number" min="0" max="400" step="1" required />
            </div>
            <div class="row">
              <label>ููฺฉ ููุฏ ฒุณุงุนุช ุจุนุฏ</label>
              <select name="linkToSlot">
                <option value="">โ</option>
                <option value="AfterBreakfast2h">ุจุนุฏ ุตุจุญุงูู</option>
                <option value="AfterLunch2h">ุจุนุฏ ูุงูุงุฑ</option>
                <option value="AfterDinner2h">ุจุนุฏ ุดุงู</option>
              </select>
            </div>
            <button class="btn btn-primary" type="submit">โ ุซุจุช ูุนุฏู</button>
          </form>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-analytics">
      <div class="grid">
        <div class="card">
          <h2>๐ Histogram ุชูุฒุน ููุฏ</h2>
          <canvas id="hist" height="220"></canvas>
        </div>
        <div class="card">
          <h2>๐งฌ AGP ููุงุด</h2>
          <canvas id="agp" height="220"></canvas>
          <div class="hint">ููุงุด ูุงูู ู ุจุงูุฏ ุฏุฑุตุฏ ุฑู ุงุณูุงุชโูุง ุฑูุฒ (ุจุฑุง UI).</div>
        </div>
        <div class="card span-2">
          <h2>๐ฏ Goals Tracker</h2>
          <div id="goals" class="goals"></div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-education">
      <div class="grid">
        <div class="card span-2">
          <h2>๐ ุขููุฒุด ุฌุงูุน (ูุชู ุฒุงุฏ + ูุฏู)</h2>
          <div class="edu-nav">
            <button class="chip-btn" data-edu="basics">ูุจุงู</button>
            <button class="chip-btn" data-edu="hypo">ููพู</button>
            <button class="chip-btn" data-edu="hyper">ูุงูพุฑ</button>
            <button class="chip-btn" data-edu="carb">ฺฉุฑุจููุฏุฑุงุช</button>
            <button class="chip-btn" data-edu="exercise">ูุฑุฒุด</button>
            <button class="chip-btn" data-edu="school">ูุฏุฑุณู/ุงูุชุญุงู</button>
          </div>
          <article id="edu-article" class="article"></article>
          <div class="video-grid">
            <div class="video"><iframe id="yt1" src="" title="YouTube" allowfullscreen></iframe></div>
            <div class="video"><iframe id="ap1" src="" title="Aparat" allowfullscreen></iframe></div>
          </div>
          <div class="hint">โ๏ธ ูุญุชูุง ุขููุฒุด ุงุณุช ู ุฌุงฺฏุฒู ูพุฒุดฺฉ ูุณุช.</div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-data">
      <section class="card">
        <h2>๐๏ธ ุฏุงุฏูโูุง (ูุฑุชุจ)</h2>
        <div class="tables">
          <div>
            <h3>๐ฉธ ููุฏ</h3>
            <div class="table-wrap">
              <table id="tbl-glucose">
                <thead><tr><th>ุชุงุฑุฎ</th><th>ุญุงูุช</th><th>ููุฏ</th><th>ุงุฏุฏุงุดุช</th><th></th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div>
            <h3>๐ ุงูุณููู</h3>
            <div class="table-wrap">
              <table id="tbl-insulin">
                <thead><tr><th>ุชุงุฑุฎ</th><th>ููุน</th><th>ูุงู</th><th>ูุงุญุฏ</th><th>ุณุงุนุช</th><th>ูุนุฏู</th><th></th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div>
            <h3>๐ฝ๏ธ ูุนุฏูโูุง</h3>
            <div class="table-wrap">
              <table id="tbl-meal">
                <thead><tr><th>ุชุงุฑุฎ</th><th>ูุนุฏู</th><th>ุดุฑุญ</th><th>ฺฉุฑุจููุฏุฑุงุช</th><th>ููฺฉ</th><th></th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </section>

    <section class="panel" id="tab-profile">
      <div class="grid">
        <div class="card">
          <h2>๐ค ูพุฑููุงู</h2>
          <form id="profile-form" class="form">
            <div class="row"><label>ูุงุญุฏ</label>
              <select name="unit"><option value="mg/dL" selected>mg/dL</option><option value="mmol/L">mmol/L</option></select>
            </div>
            <div class="row"><label>ููุน</label>
              <select name="diabetesType"><option value="Type 1" selected>Type 1</option><option value="Type 2">Type 2</option></select>
            </div>
            <div class="row"><label>ูุฏู ูพุงู</label><input name="targetLow" type="number" value="80"/></div>
            <div class="row"><label>ูุฏู ุจุงูุง</label><input name="targetHigh" type="number" value="180"/></div>

            <hr class="sep"/>

            <div class="row"><label>ูุฏ</label><input name="heightCm" type="number" placeholder="cm"/></div>
            <div class="row"><label>ูุฒู</label><input name="weightKg" type="number" placeholder="kg"/></div>
            <div class="row"><label>ุณุงู ุชููุฏ</label><input name="birthYear" type="number"/></div>
            <div class="row"><label>ุดุฑูุน ุจูุงุฑ</label><input name="dxDate" type="date"/></div>
            <div class="row"><label>ุณุงุฑ ุจูุงุฑโูุง</label><input name="otherCond" type="text"/></div>

            <button class="btn btn-primary" type="submit">๐พ ุฐุฎุฑู</button>
          </form>
        </div>

        <div class="card">
          <h2>๐ ูุฏ/ูุฒู (ููุงุด)</h2>
          <canvas id="growthChart" height="220"></canvas>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-sickday">
      <div class="grid">
        <div class="card span-2">
          <h2>๐งฐ Sick-day & Ketone checklist</h2>
          <div class="checklist" id="sick-check"></div>
          <div class="hint">โ ฺฺฉโูุณุช ุชุนุงูู ุจุฑุง ุดุฑุงุท ุจูุงุฑ/ููุฏ ุจุงูุง (ุขููุฒุด).</div>
        </div>
      </div>
    </section>

    <section class="panel" id="tab-audit">
      <div class="grid">
        <div class="card span-2">
          <h2>๐งพ Log ุชุบุฑุงุช</h2>
          <div class="table-wrap">
            <table id="tbl-audit">
              <thead><tr><th>ุฒูุงู</th><th>ุนููุงุช</th><th>ุฌุฒุฆุงุช</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="hint">ูุฑ ุซุจุช/ุญุฐู ุจุฑุง ุงุนุชูุงุฏ ู ูพฺฏุฑ (ููุงุด).</div>
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">ููุฏุงุฑ ๐ โ ูุณุฎู ูุจ ุขููุฒุด/ุฏูู</footer>

  <script src="./food_db.js"></script>
  <script src="./sample_data.js"></script>
  <script src="./app.js"></script>
</body>
</html>
